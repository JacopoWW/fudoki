# 復読機 (Fudoki) – Flask + SudachiPy + Web Speech

復読機は、テキストを形態素解析して「語の気泡」表示を行い、ブラウザの Web Speech API で読み上げる学習支援ツールです。Python/Flask で分割 API を提供し、フロントは `templates/index.html` と `static/main.js` の素朴な構成です。

このリポジトリは Python 版のみです（旧スタンドアロン静的ページは削除済み）。

## 主な機能
- 分割 API（`/api/segment`）: SudachiPy で単語に分割し、読み仮名・品詞を付与
- 読み上げ:
  - 語をクリックで単語読み上げ、長押しで行読み上げ
  - 各行右下に「行ループ」ボタン（再生/一時停止トグル）
  - 全文再生＋ループ（ヘッダーのループボタン）
  - 読み上げ中の行は目立つ緑、読み終えた行は淡いピンクで表示し、常に画面中央にスクロール
  - 既定で日本語音声「Kyoko」を優先（なければ他の日本語音声）/ 速度 0.5–2.0x 調整可
- 複数テキスト管理:
  - 上部ドロップダウンで切替、右側の「＋」で新規作成
  - 編集はエディタ内の「保存」「削除」で操作（保存後に即分割）
  - 初回起動時にロックされた既定の教材を自動作成（削除不可）
- 表示・分割の挙動:
  - サーバ側: 入力は「改行単位」で1行として分割処理（括弧内（…）/ (...) は分割前に除去し、読み上げからも除外）
  - クライアント側: 受け取ったトークン列を
    - 「句読点」で行分割（句読点は表示しない）
    - 「英字トークン」「ひらがなトークン」でも行分割（当該トークンは新行の先頭に残す）
- テーマ/外観:
  - ライト/ダーク切替、行は丸み＋軽いシャドウ、フッターを同梱

## ディレクトリ
```
ja-reader/
├── app.py              # Flask アプリ本体（/api/segment, 起動エントリ）
├── requirements.txt    # 依存（Flask, SudachiPy, sudachidict_core）
├── templates/
│   └── index.html      # 画面テンプレート（Tailwind CDN 利用）
└── static/
    └── main.js         # UI ロジック（表示・読み上げ・管理）
```

## セットアップ
1. Python 3.10+ を用意
2. 依存インストール
```
pip install -r ja-reader/requirements.txt
```
`sudachidict_core` が自動で入り、SudachiPy がすぐ利用できます。

## 起動
```
python ja-reader/app.py              # 既定: http://127.0.0.1:8000/
python ja-reader/app.py 8080        # ポート指定
```

## 使い方の要点
- ドロップダウン右の「＋」で新規テキストを作成。1行目がタイトルとして一覧に表示されます（24 文字で省略表示）。
- 「現在のテキストを編集する」からエディタを開き、保存すると即分割＆表示されます。削除は既定教材以外で可能。
- 行右下の丸いボタンで「その行だけをリピート」できます（クリックで再生/一時停止）。
- ヘッダーのループアイコンで全文ループを切替。音声と速度は上部コントロールから調整。

## 備考（音声/TTS）
- 音声は OS/ブラウザに依存します。必要に応じて日本語音声を OS に追加してください。
  - macOS: 設定 > アクセシビリティ > 読み上げコンテンツ > 声
  - Windows: 設定 > 時刻と言語 > 言語と地域（音声パック）
- Safari などはユーザー操作後でないと再生できない場合があります。

## ライセンス
プロジェクト方針に合わせて LICENSE を追加してください。
